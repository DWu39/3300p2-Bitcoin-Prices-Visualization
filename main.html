<html>
<head>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <style>
        svg {
            border: 1px solid black;
            padding: 30px;
        }
        
        /* Styling from http://alignedleft.com/tutorials/d3/axes*/
        .axis path,
        .axis line {
            fill: none;
            shape-rendering: crispEdges;
            stroke: black;
        }
        .axis text { font-size: 11px; }
        
        /* Styling from https://gist.github.com/benjchristensen/2579599 */
        .line {
            fill: none;
            stroke: steelblue;
            stroke-width: 2;
        }
        
        .area {
            fill: lightsteelblue;
            stroke-width: 0;
        }
    </style>
</head>
<body>
    <div id='timeframe'>Bitcoin Price from to</div>
    <div id='graph'></div>
    
<script>
    // create canvas for graph
    var height = 500;
    var width = 900;

    var svg = d3.select("#graph").append("svg").attr("height", height).attr("width", width);

    /**
    * Helper functions
    */
    
    // helper function
    function getDate(d) {
        return new Date(d.time);
    }
    
    // return an object with time string parsed
    var parseTime = function(datetime) {
        var datetime = datetime.split(" ");
        var date = datetime[0].split("/");
        var time = datetime[1].split(":");
        
        var year = 20+date[2];
        var month = date[0];
        var day = date[1];
        var hour = time[0];
        var minute = time[1];
        var period;
        
        if (hour < 12) {
            if (hour == 0) {
                hour = 12;
            }
            period = "AM";
        } else {
            if (hour > 12) {
                hour = +hour%12;
            }
            period = "PM";
        }

        return {
            time: datetime.join(" "),
            year: +year,
            month: +month,
            day: +day,
            hour: +hour,
            minute: +minute,
            period: period
        };
    }

    /**
    * create graph functions
    */

    // create minute timeframe graph
    var minuteGraph = function (data) {
        var xMin = data[0].time;
        var xMax = data[data.length-1].time;

        var xMin = 0;
        var xMax = data.length-1;

        var yMin = d3.min(data, function(d) { return d.price; });
        var yMax = d3.max(data, function(d) { return d.price; });

        // date/time
        var xScale = d3.scale.linear().domain([xMin, xMax]).range([0, width]);
        var xAxis = d3.svg.axis().scale(xScale);
        svg.append("g").attr("class", "axis").attr("transform", "translate(0," + (height) + ")").call(xAxis);

        // price
        var yScale = d3.scale.linear().domain([yMin, yMax]).range([height, 0]);
        var yAxis = d3.svg.axis().scale(yScale).orient("left");
        svg.append("g").attr("class", "axis").call(yAxis);
        
        // area under line http://www.d3noob.org/2013/01/filling-area-under-graph.html
        var area = d3.svg.area()
            .x(function(d, i) { return xScale(i); })
            .y0(height)
            .y1(function(d) { return yScale(d.price); });
        
        svg.append("path").datum(data).attr("class", "area").attr("d", area);
        
        // line function for converting data to x,y https://gist.github.com/benjchristensen/2579599
        var line = d3.svg.line()
        .x(function(d, i) { return xScale(i); })
        .y(function(d) { return yScale(d.price); });

        svg.append("path").attr("class", "line").attr("d", line(data));

    }

    /**
    * rest of the script
    */

    // holds the bitcoin prices and times
    var points = [];

    // pull the data for the bitcoins and create the graph
    d3.csv("bitcoinstest.csv", function(d) {
        var point = parseTime(d.time);
        point.price = +d.buying;
        return point;

    }, function(error, rows) {
        points = rows;

        // TODO: create the default graph
        // Call a create graph function that we can swap out if we want to change the default graph
        minuteGraph(points);
    });
    
</script>
</body>
</html>
