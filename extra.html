<!--Extra code-->
<div>
    <br>
        Start <input type="date" id="start" value="2013-12-27">
        End <input type="date" id="end" value="2014-04-20">
        <button type="button" onclick="newDate(); return false;">Change timeframe</button>
        <p id="error"></p>
</div>

<script>
    // TODO: update graph after changing date range
    function newDate() {
        // clear previous errors
        document.getElementById("error").innerHTML = "";
        
        // grab user inputs
        var start = new Date(document.getElementById("start").value);
        var end = new Date(document.getElementById("end").value);
        start = start.toLocaleDateString();
        end = end.toLocaleDateString();
        
        // check valid date range
        if (start > end) {
            document.getElementById("error").innerHTML = "Please enter a valid date range.";
            return false;
        }

        // used to splice daData array
        var startIndex,
            endIndex;
                
        // recreate graph with modified date array
        daData.forEach(function(d, i) {
            var currTime = d.time.toLocaleDateString();
            if (currTime === start && !startIndex) {
                console.log(currTime);
                startIndex = i;
            };
            
            if (currTime === end && !endIndex) {
                console.log(currTime);
                endIndex = i;
            }
        });
        
        // check if indices found
        if (!startIndex || !endIndex) {
            document.getElementById("error").innerHTML = "No data for that date range.";
        }

        // clear graph and title
        d3.select("svg").remove();
        d3.select("#timeframe").text("");

        // recreate canvas and graph
        svg = d3.select("#graph").append("svg").attr("height", height).attr("width", width);
        createGraph(daData.slice(startIndex, endIndex));
    }

    // DEPRECATED: update the graph WITHOUT animations after user selects new timeframe
    function update(dataFile) {
        // clear graph
        d3.select("svg").remove();        
        // clear title
        d3.select("#timeframe").text("");
        // recreate canvas
        svg = d3.select("#graph").append("svg").attr("height", height).attr("width", width);
        // recreate graph with new data
        createData(dataFile);
    }

    // DEPRECATED: set the timeframe paragraph
    var setTimeframe = function(first, last) {
        // to cut off day of the week part of string
        var whitespace = first.toDateString().indexOf(" ");

        // check if looking within one day
        if (first.toDateString() === last.toDateString()) {
            d3.select("#timeframe").append("text").text("Buy prices on "+first.toDateString().substring(whitespace+1)
                                                        +" from"+" "+formatAMPM(first)+" to "+" "+formatAMPM(last))
        } else {
            d3.select("#timeframe").append("text").text("Buy prices from "+first.toDateString().substring(whitespace+1)
                                                        +" "+formatAMPM(first)+" to "+last.toDateString().substring(whitespace+1)+" "+formatAMPM(last))
        }
    }
    
    // area under line http://www.d3noob.org/2013/01/filling-area-under-graph.html
    // line function for converting data to x,y https://gist.github.com/benjchristensen/2579599   
</script>